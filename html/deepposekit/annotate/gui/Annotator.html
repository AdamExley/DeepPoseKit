<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.0" />
<title>deepposekit.annotate.gui.Annotator API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>deepposekit.annotate.gui.Annotator</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
# Copyright 2018-2019 Jacob M. Graving &lt;jgraving@gmail.com&gt;
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at

#    http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import numpy as np
import h5py
import os

from deepposekit.annotate.gui.GUI import GUI
from deepposekit.annotate.utils import hotkeys as keys

__all__ = [&#34;Annotator&#34;]


class Annotator(GUI):

    &#34;&#34;&#34;
    A GUI for annotating images.

    ------------------------------------------------------------
         Keys             |   Action
    ------------------------------------------------------------
    &gt;    +,-              |   Rescale the image
    &gt;    Left mouse       |   Move active keypoint
    &gt;    W, A, S, D       |   Move active keypoint
    &gt;    space            |   Changes W,A,S,D mode (swaps between 1px or 10px)
    &gt;    J, L             |   Load previous or next image
    &gt;    &lt;, &gt;             |   Jump 10 images backward or forward
    &gt;    I, K or          |
         tab, shift+tab   |   Switch active keypoint
    &gt;    R                |   Mark frame as unannotated, or &#34;reset&#34;
    &gt;    F                |   Mark frame as annotated or &#34;finished&#34;
    &gt;    Esc, Q           |   Quit the Annotator GUI
    ------------------------------------------------------------

    Note: Data is automatically saved when moving between frames.

    Parameters
    ----------
    datapath: str
        Filepath of the HDF5 (.h5) file that contains the images to
        be annotated.

    dataset: str
        Key name to access the images in the .h5 file.

    skeleton: str
        Filepath of the .csv or .xlsx file that has indexed information
        on name of the keypoint (part, e.g. head), parent (the direct
        connecting part, e.g. neck connects to head, parent is head),
        and swap (swapping positions with a part when reflected).

        See example file for more information.

    scale: int/float, default 1
        Scaling factor for the GUI (e.g. used in zooming).

    text_scale: float
        Scaling factor for the GUI font.
        A text_scale of 1 works well for 1920x1080 (1080p) images
    
    shuffle_colors: bool, default = True
        Whether to shuffle the color order for drawing keypoints

    refresh: int, default 100
        Delay on receiving next keyboard input in milliseconds.

    Attributes
    ----------
    window_name: str
        Name of the Annotation window when running program.
        Set to be &#39;Annotation&#39; unless otherwise changed.

    n_images: int
        Number of images in the .h5 file.

    n_keypoints: int
        Number of keypoints in the skeleton.

    key: int
        The key that is pressed on the keyboard.

    image_idx: int
        Index of a specific image in the .h5 file.

    image: numpy.ndarray
        One image accessed using image_idx.

    Example
    -------
    &gt;&gt;&gt; from deepposekit import Annotator
    &gt;&gt;&gt; app = Annotator(&#39;annotation.h5&#39;, &#39;images&#39;, &#39;skeleton.csv&#39;)
    &gt;&gt;&gt; app.run()

    &#34;&#34;&#34;

    def __init__(
        self,
        datapath,
        dataset,
        skeleton,
        scale=1,
        text_scale=0.15,
        shuffle_colors=True,
        refresh=100,
    ):
        super(GUI, self).__init__()

        self.window_name = &#34;Annotation&#34;
        self.shuffle_colors = shuffle_colors
        self._init_skeleton(skeleton)
        if os.path.exists(datapath):
            self._init_data(datapath, dataset)
        else:
            raise ValueError(&#34;datapath file or path does not exist&#34;)
        self._init_gui(scale, text_scale, shuffle_colors, refresh)

    def _init_data(self, datapath, dataset):
        &#34;&#34;&#34; Initializes the images from the .h5 file (called in init).

        Parameters
        ----------
        datapath: str
            Path of the .h5 file that contains the images to be annotated.

        dataset: str
            Key name to access the images in the .h5 file.

        &#34;&#34;&#34;
        if isinstance(datapath, str):
            if datapath.endswith(&#34;.h5&#34;):
                self.datapath = datapath
            else:
                raise ValueError(&#34;datapath must be .h5 file&#34;)
        else:
            raise TypeError(&#34;datapath must be type `str`&#34;)

        if isinstance(dataset, str):
            self.dataset = dataset
        else:
            raise TypeError(&#34;dataset must be type `str`&#34;)

        with h5py.File(self.datapath, &#34;r+&#34;) as h5file:

            self.n_images = h5file[self.dataset].shape[0]
            # Check that all parts of the file exist
            if &#34;annotations&#34; not in list(h5file.keys()):
                empty_array = np.zeros((self.n_images, self.n_keypoints, 2))
                h5file.create_dataset(
                    &#34;annotations&#34;,
                    (self.n_images, self.n_keypoints, 2),
                    dtype=np.float64,
                    data=empty_array,
                )
                for idx in range(self.n_images):
                    h5file[&#34;annotations&#34;][idx] = self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]].values

            if &#34;annotated&#34; not in list(h5file.keys()):
                empty_array = np.zeros((self.n_images, self.n_keypoints), dtype=bool)
                h5file.create_dataset(
                    &#34;annotated&#34;,
                    (self.n_images, self.n_keypoints),
                    dtype=bool,
                    data=empty_array,
                )

            if &#34;skeleton&#34; not in list(h5file.keys()):
                skeleton = self.skeleton[[&#34;tree&#34;, &#34;swap_index&#34;]].values
                h5file.create_dataset(
                    &#34;skeleton&#34;, skeleton.shape, dtype=np.int32, data=skeleton
                )

            # Unpack the images from the file
            self.image_idx = np.sum(np.all(h5file[&#34;annotated&#34;].value, axis=1)) - 1

            self.image = h5file[self.dataset][self.image_idx]
            self._check_grayscale()
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _save(self):
        &#34;&#34;&#34; Saves an image.

        Automatically called when moving to new images or invoked manually
        using &#39;ctrl + s&#39; keys.

        &#34;&#34;&#34;
        with h5py.File(self.datapath) as h5file:

            h5file[&#34;annotations&#34;][self.image_idx] = self.skeleton.loc[
                :, [&#34;x&#34;, &#34;y&#34;]
            ].values
            h5file[&#34;annotated&#34;][self.image_idx] = self.skeleton.loc[
                :, &#34;annotated&#34;
            ].values
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _load(self):
        &#34;&#34;&#34; Loads an image.

        This method is called in _move_image_idx when moving to different
        images. The image of specified image_idx will be loaded onto the GUI.

        &#34;&#34;&#34;

        with h5py.File(self.datapath) as h5file:

            self.image = h5file[self.dataset][self.image_idx]
            self._check_grayscale()
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _last_image(self):
        &#34;&#34;&#34; Checks if image index is on the last index.
    
        Helper method to check for the index of the last image in the h5 file.

        Returns
        -------
        bool
            Indicate if image_idx is the last index.

        &#34;&#34;&#34;

        return self.image_idx == self.n_images - 1

    def _move_image_idx(self):
        &#34;&#34;&#34; Move to different image.
        
        Based on the key pressed, updates the image on the GUI.
        The scheme is as follows:
        ------------------------------------------------------------
             Keys             |   Action                           
        ------------------------------------------------------------
        &gt;    &lt;- , -&gt;          |   Load previous or next image
        &gt;    ,  ,  .          |   Jump 10 images backward or forward
        ------------------------------------------------------------

        Every time the user moves from the image, the annotations
        on the image is saved before loading the next image.

        &#34;&#34;&#34;

        # &lt;- (left arrow) key
        if self.key is keys.LEFTARROW:
            self._save()
            if self.image_idx == 0:
                self.image_idx = self.n_images - 1
            else:
                self.image_idx -= 1
            self._load()
        # -&gt; (right arrow) key
        elif self.key is keys.RIGHTARROW:
            self._save()
            if self._last_image():
                self.image_idx = 0
            else:
                self.image_idx += 1
            self._load()

        # . (period) key
        elif self.key is keys.LESSTHAN:
            self._save()
            if self.image_idx - 10 &lt; 0:
                self.image_idx = self.n_images + self.image_idx - 10
            else:
                self.image_idx -= 10
            self._load()
        # , (comma) key
        elif self.key is keys.GREATERTHAN:
            self._save()
            if self.image_idx + 10 &gt; self.n_images - 1:
                self.image_idx = self.image_idx + 10 - self.n_images
            else:
                self.image_idx += 10
            self._load()

    def _data(self):
        &#34;&#34;&#34; Activates key bindings for annotated and save.
        
        Creates additional key bindings for the program.
        The bindings are as follows:
        
        ------------------------------------------------------------
             Keys             |   Action                           
        ------------------------------------------------------------
        &gt;    Ctrl-R           |   Mark frame as unannotated
        &gt;    Ctrl-F           |   Mark frame as annotated
        &gt;    Ctrl-S           |   Save
        ------------------------------------------------------------

        &#34;&#34;&#34;

        if self.key is keys.R:
            self.skeleton[&#34;annotated&#34;] = False
        elif self.key is keys.F:
            self.skeleton[&#34;annotated&#34;] = True
        elif self.key in [keys.Q, keys.ESC]:
            self._save()
            print(&#34;Saved&#34;)

    def _hotkeys(self):
        &#34;&#34;&#34; Activates all key bindings.
        
        Enables all the key functionalities described at the
        start of the file.

        &#34;&#34;&#34;

        if self.key != keys.NONE:
            self._wasd()
            self._move_idx()
            self._move_image_idx()
            self._zoom()
            self._data()
            self._update_canvas()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="deepposekit.annotate.gui.Annotator.Annotator"><code class="flex name class">
<span>class <span class="ident">Annotator</span></span>
<span>(</span><span>datapath, dataset, skeleton, scale=1, text_scale=0.15, shuffle_colors=True, refresh=100)</span>
</code></dt>
<dd>
<section class="desc"><p>A GUI for annotating images.</p>
<hr>
<pre><code> Keys             |   Action
</code></pre>
<hr>
<blockquote>
<p>+,-
|
Rescale the image
Left mouse
|
Move active keypoint
W, A, S, D
|
Move active keypoint
space
|
Changes W,A,S,D mode (swaps between 1px or 10px)
J, L
|
Load previous or next image
&lt;, &gt;
|
Jump 10 images backward or forward
I, K or
|
tab, shift+tab
|
Switch active keypoint
R
|
Mark frame as unannotated, or "reset"
F
|
Mark frame as annotated or "finished"
Esc, Q
|
Quit the Annotator GUI</p>
</blockquote>
<hr>
<p>Note: Data is automatically saved when moving between frames.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>datapath</code></strong> :&ensp;<code>str</code></dt>
<dd>Filepath of the HDF5 (.h5) file that contains the images to
be annotated.</dd>
<dt><strong><code>dataset</code></strong> :&ensp;<code>str</code></dt>
<dd>Key name to access the images in the .h5 file.</dd>
<dt><strong><code>skeleton</code></strong> :&ensp;<code>str</code></dt>
<dd>
<p>Filepath of the .csv or .xlsx file that has indexed information
on name of the keypoint (part, e.g. head), parent (the direct
connecting part, e.g. neck connects to head, parent is head),
and swap (swapping positions with a part when reflected).</p>
<p>See example file for more information.</p>
</dd>
<dt><strong><code>scale</code></strong> :&ensp;<code>int</code>/<code>float</code>, default <code>1</code></dt>
<dd>Scaling factor for the GUI (e.g. used in zooming).</dd>
<dt><strong><code>text_scale</code></strong> :&ensp;<code>float</code></dt>
<dd>Scaling factor for the GUI font.
A text_scale of 1 works well for 1920x1080 (1080p) images</dd>
<dt><strong><code>shuffle_colors</code></strong> :&ensp;<code>bool</code>, default = <code>True</code></dt>
<dd>Whether to shuffle the color order for drawing keypoints</dd>
<dt><strong><code>refresh</code></strong> :&ensp;<code>int</code>, default <code>100</code></dt>
<dd>Delay on receiving next keyboard input in milliseconds.</dd>
</dl>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>window_name</code></strong> :&ensp;<code>str</code></dt>
<dd>Name of the Annotation window when running program.
Set to be 'Annotation' unless otherwise changed.</dd>
<dt><strong><code>n_images</code></strong> :&ensp;<code>int</code></dt>
<dd>Number of images in the .h5 file.</dd>
<dt><strong><code>n_keypoints</code></strong> :&ensp;<code>int</code></dt>
<dd>Number of keypoints in the skeleton.</dd>
<dt><strong><code>key</code></strong> :&ensp;<code>int</code></dt>
<dd>The key that is pressed on the keyboard.</dd>
<dt><strong><code>image_idx</code></strong> :&ensp;<code>int</code></dt>
<dd>Index of a specific image in the .h5 file.</dd>
<dt><strong><code>image</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>One image accessed using image_idx.</dd>
</dl>
<h2 id="example">Example</h2>
<pre><code>&gt;&gt;&gt; from deepposekit import Annotator
&gt;&gt;&gt; app = Annotator('annotation.h5', 'images', 'skeleton.csv')
&gt;&gt;&gt; app.run()
</code></pre>
<p>A GUI for annotating or marking up image(s).</p>
<p>The GUI class works with a subclass to run a program that could be
used to annotate or markup an image or a series of images.
In order to extend the GUI class to make a subclass, a few things
must be defined in the subclass.</p>
<hr>
<pre><code>Method      |
</code></pre>
<hr>
<h2 id="_hotkeys-activates-all-the-hotkey-bindings">&gt;
_hotkeys()
|
Activates all the hotkey bindings</h2>
<pre><code>Attribute   |
</code></pre>
<hr>
<blockquote>
<p>window_name |
Name of application window
image_idx
|
Index of active image, important for multiple images
n_images
|
Number of total images</p>
</blockquote>
<hr>
<p>See the Annotator.py or Skeleton.py for an example of how this is done</p>
<h2 id="attributes_1">Attributes</h2>
<dl>
<dt><strong><code>scale</code></strong> :&ensp;<code>float</code></dt>
<dd>Scaling factor for the GUI (e.g. used in zooming).</dd>
<dt><strong><code>text_scale</code></strong> :&ensp;<code>float</code></dt>
<dd>Scaling factor for the GUI font.
A text_scale of 1 is good for 1920x1080 (1080p) images</dd>
<dt><strong><code>refresh</code></strong> :&ensp;<code>int</code></dt>
<dd>Delay on receiving next keyboard input in milliseconds.</dd>
<dt><strong><code>point</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>The coordinates of the mouse on the GUI.</dd>
<dt><strong><code>image</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>One image accessed using image_idx.</dd>
<dt><strong><code>canvas</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>Canvas for the GUI itself.</dd>
<dt><strong><code>skeleton</code></strong> :&ensp;<code>pandas.DataFrame</code></dt>
<dd>Store information from the skeleton data input.</dd>
<dt><strong><code>idx</code></strong> :&ensp;<code>int</code></dt>
<dd>Index of the keypoint in question.</dd>
<dt><strong><code>keypoint_idx</code></strong> :&ensp;<code>numpy.ndarray</code></dt>
<dd>Keeps track of the keypoints array.</dd>
<dt><strong><code>n_keypoints</code></strong> :&ensp;<code>int</code></dt>
<dd>Total number of keypoints in an image.</dd>
<dt><strong><code>text_locs</code></strong> :&ensp;<code>list</code></dt>
<dd>List of text locations.</dd>
<dt><strong><code>key</code></strong> :&ensp;<code>int</code></dt>
<dd>The key that is pressed on the keyboard.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Annotator(GUI):

    &#34;&#34;&#34;
    A GUI for annotating images.

    ------------------------------------------------------------
         Keys             |   Action
    ------------------------------------------------------------
    &gt;    +,-              |   Rescale the image
    &gt;    Left mouse       |   Move active keypoint
    &gt;    W, A, S, D       |   Move active keypoint
    &gt;    space            |   Changes W,A,S,D mode (swaps between 1px or 10px)
    &gt;    J, L             |   Load previous or next image
    &gt;    &lt;, &gt;             |   Jump 10 images backward or forward
    &gt;    I, K or          |
         tab, shift+tab   |   Switch active keypoint
    &gt;    R                |   Mark frame as unannotated, or &#34;reset&#34;
    &gt;    F                |   Mark frame as annotated or &#34;finished&#34;
    &gt;    Esc, Q           |   Quit the Annotator GUI
    ------------------------------------------------------------

    Note: Data is automatically saved when moving between frames.

    Parameters
    ----------
    datapath: str
        Filepath of the HDF5 (.h5) file that contains the images to
        be annotated.

    dataset: str
        Key name to access the images in the .h5 file.

    skeleton: str
        Filepath of the .csv or .xlsx file that has indexed information
        on name of the keypoint (part, e.g. head), parent (the direct
        connecting part, e.g. neck connects to head, parent is head),
        and swap (swapping positions with a part when reflected).

        See example file for more information.

    scale: int/float, default 1
        Scaling factor for the GUI (e.g. used in zooming).

    text_scale: float
        Scaling factor for the GUI font.
        A text_scale of 1 works well for 1920x1080 (1080p) images
    
    shuffle_colors: bool, default = True
        Whether to shuffle the color order for drawing keypoints

    refresh: int, default 100
        Delay on receiving next keyboard input in milliseconds.

    Attributes
    ----------
    window_name: str
        Name of the Annotation window when running program.
        Set to be &#39;Annotation&#39; unless otherwise changed.

    n_images: int
        Number of images in the .h5 file.

    n_keypoints: int
        Number of keypoints in the skeleton.

    key: int
        The key that is pressed on the keyboard.

    image_idx: int
        Index of a specific image in the .h5 file.

    image: numpy.ndarray
        One image accessed using image_idx.

    Example
    -------
    &gt;&gt;&gt; from deepposekit import Annotator
    &gt;&gt;&gt; app = Annotator(&#39;annotation.h5&#39;, &#39;images&#39;, &#39;skeleton.csv&#39;)
    &gt;&gt;&gt; app.run()

    &#34;&#34;&#34;

    def __init__(
        self,
        datapath,
        dataset,
        skeleton,
        scale=1,
        text_scale=0.15,
        shuffle_colors=True,
        refresh=100,
    ):
        super(GUI, self).__init__()

        self.window_name = &#34;Annotation&#34;
        self.shuffle_colors = shuffle_colors
        self._init_skeleton(skeleton)
        if os.path.exists(datapath):
            self._init_data(datapath, dataset)
        else:
            raise ValueError(&#34;datapath file or path does not exist&#34;)
        self._init_gui(scale, text_scale, shuffle_colors, refresh)

    def _init_data(self, datapath, dataset):
        &#34;&#34;&#34; Initializes the images from the .h5 file (called in init).

        Parameters
        ----------
        datapath: str
            Path of the .h5 file that contains the images to be annotated.

        dataset: str
            Key name to access the images in the .h5 file.

        &#34;&#34;&#34;
        if isinstance(datapath, str):
            if datapath.endswith(&#34;.h5&#34;):
                self.datapath = datapath
            else:
                raise ValueError(&#34;datapath must be .h5 file&#34;)
        else:
            raise TypeError(&#34;datapath must be type `str`&#34;)

        if isinstance(dataset, str):
            self.dataset = dataset
        else:
            raise TypeError(&#34;dataset must be type `str`&#34;)

        with h5py.File(self.datapath, &#34;r+&#34;) as h5file:

            self.n_images = h5file[self.dataset].shape[0]
            # Check that all parts of the file exist
            if &#34;annotations&#34; not in list(h5file.keys()):
                empty_array = np.zeros((self.n_images, self.n_keypoints, 2))
                h5file.create_dataset(
                    &#34;annotations&#34;,
                    (self.n_images, self.n_keypoints, 2),
                    dtype=np.float64,
                    data=empty_array,
                )
                for idx in range(self.n_images):
                    h5file[&#34;annotations&#34;][idx] = self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]].values

            if &#34;annotated&#34; not in list(h5file.keys()):
                empty_array = np.zeros((self.n_images, self.n_keypoints), dtype=bool)
                h5file.create_dataset(
                    &#34;annotated&#34;,
                    (self.n_images, self.n_keypoints),
                    dtype=bool,
                    data=empty_array,
                )

            if &#34;skeleton&#34; not in list(h5file.keys()):
                skeleton = self.skeleton[[&#34;tree&#34;, &#34;swap_index&#34;]].values
                h5file.create_dataset(
                    &#34;skeleton&#34;, skeleton.shape, dtype=np.int32, data=skeleton
                )

            # Unpack the images from the file
            self.image_idx = np.sum(np.all(h5file[&#34;annotated&#34;].value, axis=1)) - 1

            self.image = h5file[self.dataset][self.image_idx]
            self._check_grayscale()
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _save(self):
        &#34;&#34;&#34; Saves an image.

        Automatically called when moving to new images or invoked manually
        using &#39;ctrl + s&#39; keys.

        &#34;&#34;&#34;
        with h5py.File(self.datapath) as h5file:

            h5file[&#34;annotations&#34;][self.image_idx] = self.skeleton.loc[
                :, [&#34;x&#34;, &#34;y&#34;]
            ].values
            h5file[&#34;annotated&#34;][self.image_idx] = self.skeleton.loc[
                :, &#34;annotated&#34;
            ].values
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _load(self):
        &#34;&#34;&#34; Loads an image.

        This method is called in _move_image_idx when moving to different
        images. The image of specified image_idx will be loaded onto the GUI.

        &#34;&#34;&#34;

        with h5py.File(self.datapath) as h5file:

            self.image = h5file[self.dataset][self.image_idx]
            self._check_grayscale()
            self.skeleton.loc[:, [&#34;x&#34;, &#34;y&#34;]] = h5file[&#34;annotations&#34;][self.image_idx]
            self.skeleton.loc[:, &#34;annotated&#34;] = h5file[&#34;annotated&#34;][self.image_idx]

    def _last_image(self):
        &#34;&#34;&#34; Checks if image index is on the last index.
    
        Helper method to check for the index of the last image in the h5 file.

        Returns
        -------
        bool
            Indicate if image_idx is the last index.

        &#34;&#34;&#34;

        return self.image_idx == self.n_images - 1

    def _move_image_idx(self):
        &#34;&#34;&#34; Move to different image.
        
        Based on the key pressed, updates the image on the GUI.
        The scheme is as follows:
        ------------------------------------------------------------
             Keys             |   Action                           
        ------------------------------------------------------------
        &gt;    &lt;- , -&gt;          |   Load previous or next image
        &gt;    ,  ,  .          |   Jump 10 images backward or forward
        ------------------------------------------------------------

        Every time the user moves from the image, the annotations
        on the image is saved before loading the next image.

        &#34;&#34;&#34;

        # &lt;- (left arrow) key
        if self.key is keys.LEFTARROW:
            self._save()
            if self.image_idx == 0:
                self.image_idx = self.n_images - 1
            else:
                self.image_idx -= 1
            self._load()
        # -&gt; (right arrow) key
        elif self.key is keys.RIGHTARROW:
            self._save()
            if self._last_image():
                self.image_idx = 0
            else:
                self.image_idx += 1
            self._load()

        # . (period) key
        elif self.key is keys.LESSTHAN:
            self._save()
            if self.image_idx - 10 &lt; 0:
                self.image_idx = self.n_images + self.image_idx - 10
            else:
                self.image_idx -= 10
            self._load()
        # , (comma) key
        elif self.key is keys.GREATERTHAN:
            self._save()
            if self.image_idx + 10 &gt; self.n_images - 1:
                self.image_idx = self.image_idx + 10 - self.n_images
            else:
                self.image_idx += 10
            self._load()

    def _data(self):
        &#34;&#34;&#34; Activates key bindings for annotated and save.
        
        Creates additional key bindings for the program.
        The bindings are as follows:
        
        ------------------------------------------------------------
             Keys             |   Action                           
        ------------------------------------------------------------
        &gt;    Ctrl-R           |   Mark frame as unannotated
        &gt;    Ctrl-F           |   Mark frame as annotated
        &gt;    Ctrl-S           |   Save
        ------------------------------------------------------------

        &#34;&#34;&#34;

        if self.key is keys.R:
            self.skeleton[&#34;annotated&#34;] = False
        elif self.key is keys.F:
            self.skeleton[&#34;annotated&#34;] = True
        elif self.key in [keys.Q, keys.ESC]:
            self._save()
            print(&#34;Saved&#34;)

    def _hotkeys(self):
        &#34;&#34;&#34; Activates all key bindings.
        
        Enables all the key functionalities described at the
        start of the file.

        &#34;&#34;&#34;

        if self.key != keys.NONE:
            self._wasd()
            self._move_idx()
            self._move_image_idx()
            self._zoom()
            self._data()
            self._update_canvas()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="deepposekit.annotate.gui.GUI.GUI" href="GUI.html#deepposekit.annotate.gui.GUI.GUI">GUI</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="deepposekit.annotate.gui.GUI.GUI" href="GUI.html#deepposekit.annotate.gui.GUI.GUI">GUI</a></b></code>:
<ul class="hlist">
<li><code><a title="deepposekit.annotate.gui.GUI.GUI.run" href="GUI.html#deepposekit.annotate.gui.GUI.GUI.run">run</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="deepposekit.annotate.gui" href="index.html">deepposekit.annotate.gui</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="deepposekit.annotate.gui.Annotator.Annotator" href="#deepposekit.annotate.gui.Annotator.Annotator">Annotator</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.0</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>